---
import { type CollectionEntry } from 'astro:content';
import { getLocalizedPath, type Locale } from '@lib/i18n';

interface Props {
  atom: CollectionEntry<'atoms'>;
  lang: Locale;
  index: number;
}

const { atom, lang, index } = Astro.props;
const { data, slug } = atom;
const href = getLocalizedPath(`/atoms/${slug.split('/').pop()}`, lang);

const statusLabel = data.status === 'done' ? 'FABRICATED' : data.status === 'wip' ? 'PROTOTYPING' : 'CONCEPT';
const isActive = data.status === 'done' || data.status === 'wip';
const atmCode = `ATM_${String(index).padStart(2, '0')}`;
---

<a href={href} class="blueprint-card flex flex-col h-full group cursor-pointer relative overflow-hidden">
  <div class="absolute top-0 right-0 p-2 z-20">
    <div class={`w-3 h-3 ${isActive && data.status === 'done' ? 'bg-primary shadow-glow' : 'border border-dashed border-wip rounded-none'}`}></div>
  </div>
  
  <div class="aspect-video w-full blueprint-window flex items-center justify-center relative">
    <div class="crosshair-tl"></div>
    <div class="crosshair-tr"></div>
    <div class="crosshair-bl"></div>
    <div class="crosshair-br"></div>
    <span class="material-symbols-outlined card-icon">
      {data.icon}
    </span>
  </div>
  
  <div class="card-body">
    <div class="card-header">
      <h3 class="card-title">{data.shortTitle}</h3>
      <span class="card-atm">{atmCode}</span>
    </div>
    
    <div class="card-tags">
      {data.stack.slice(0, 2).map((tech: string) => (
        <span class="card-tag">[ {tech.toUpperCase()} ]</span>
      ))}
    </div>
    
    <p class="card-description">
      {data.description}
    </p>
    
    <div class="card-footer">
      <span class={`card-status ${data.status === 'done' ? 'card-status--done' : 'card-status--wip'}`}>
        STATUS: {statusLabel}
      </span>
      <span class="material-symbols-outlined card-footer-icon">
        {data.status === 'done' ? 'arrow_forward' : 'construction'}
      </span>
    </div>
  </div>
</a>

<style>
  /* Card container */
  .blueprint-card {
    background-color: theme('colors.plate-dark');
    border: 1px solid theme('colors.border-dark');
    box-shadow: theme('boxShadow.hard');
    text-decoration: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .blueprint-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 15px theme('colors.primary-dim'), theme('boxShadow.hard');
    border-color: theme('colors.primary');
    text-decoration: none;
  }

  /* Blueprint grid window */
  .blueprint-window {
    background-color: theme('colors.obsidian');
    border-bottom: 1px solid theme('colors.border-dark');
    background-image: 
        linear-gradient(theme('colors.primary-faint') 1px, transparent 1px),
        linear-gradient(90deg, theme('colors.primary-faint') 1px, transparent 1px);
    background-size: 20px 20px;
  }

  /* Icon in window */
  .card-icon {
    color: theme('colors.icon-bright');
    font-size: 3.75rem;
    transition: transform 0.3s ease;
  }
  .blueprint-card:hover .card-icon {
    transform: scale(1.1);
  }

  /* Crosshair corners */
  .crosshair-tl, .crosshair-tr, .crosshair-bl, .crosshair-br {
    position: absolute;
    width: 10px;
    height: 10px;
    border-color: theme('colors.marker');
    transition: all 0.3s ease;
  }
  .crosshair-tl { top: 8px; left: 8px; border-top: 1px solid; border-left: 1px solid; }
  .crosshair-tr { top: 8px; right: 8px; border-top: 1px solid; border-right: 1px solid; }
  .crosshair-bl { bottom: 8px; left: 8px; border-bottom: 1px solid; border-left: 1px solid; }
  .crosshair-br { bottom: 8px; right: 8px; border-bottom: 1px solid; border-right: 1px solid; }
  .blueprint-card:hover .crosshair-tl,
  .blueprint-card:hover .crosshair-tr,
  .blueprint-card:hover .crosshair-bl,
  .blueprint-card:hover .crosshair-br {
    border-color: theme('colors.primary');
  }

  /* Card body */
  .card-body {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  /* Title row */
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.5rem;
  }
  .card-title {
    font-family: 'Teko', 'Space Grotesk', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: theme('colors.content-bright');
    letter-spacing: 0.6px;
    line-height: 2rem;
    text-transform: uppercase;
    margin: 0;
  }
  .card-atm {
    font-family: 'Fira Code', monospace;
    font-size: 0.75rem;
    font-weight: 700;
    color: theme('colors.secondary');
    flex-shrink: 0;
    margin-left: 0.5rem;
  }

  /* Stack tags */
  .card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  .card-tag {
    font-family: 'Fira Code', monospace;
    font-size: 0.75rem;
    color: theme('colors.content-dim');
    background: theme('colors.obsidian');
    padding: 0.25rem 0.5rem;
  }

  /* Description */
  .card-description {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.875rem;
    font-weight: 300;
    color: theme('colors.content-dim');
    line-height: 1.625;
    margin: 0 0 1rem 0;
    flex-grow: 1;
  }

  /* Footer */
  .card-footer {
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid theme('colors.border-dark');
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .card-status {
    font-family: 'Fira Code', monospace;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
  }
  .card-status--done {
    color: theme('colors.primary');
  }
  .blueprint-card:hover .card-status--done {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  .card-status--wip {
    color: theme('colors.wip');
  }
  .card-footer-icon {
    font-size: 0.875rem;
    color: theme('colors.icon-muted');
    font-family: 'Material Symbols Outlined';
  }
  .blueprint-card:hover .card-footer-icon {
    color: theme('colors.primary');
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: .5; }
  }
</style>
