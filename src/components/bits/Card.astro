---
import { getLocalizedPath, type Locale } from "@lib/i18n";
import { type CollectionEntry } from "astro:content";
import XiuhcoatlBar from "./XiuhcoatlBar.astro";

interface Props {
  project: CollectionEntry<'bits'>;
  lang: Locale;
  index: number;
}

const { project, lang, index } = Astro.props;
const { data, slug } = project;
const href = getLocalizedPath(`/bits/${slug.split('/').pop()}`, lang);
const prjCode = `PRJ_${String(index).padStart(2, '0')}`;
---

<a href={href} class="project-card group">
  <div class="card-header">
    <span class="card-prj">{prjCode}</span>
    <div class="card-status-group">
      <span class:list={["card-status-dot", { "card-status-dot--pulse": data.status !== 'done' }]}></span>
      <span class:list={["card-status-label", { "card-status-label--pulse": data.status !== 'done' }]}>
        {data.status.toUpperCase()}
      </span>
    </div>
  </div>
  
  <h3 class="card-title">{data.title}</h3>
  
  <p class="card-description">{data.description}</p>
  
  <div class="card-footer">
    <XiuhcoatlBar progress={data.progress} />
    
    <div class="card-tags">
      {data.stack.slice(0, 3).map((tech: string) => (
        <span class="card-tag">[ {tech} ]</span>
      ))}
    </div>
  </div>
</a>

<style>
  .project-card {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 320px;
    padding: 1.5rem;
    background: #222;
    border: 1px solid #444;
    text-decoration: none;
    position: relative;
    transition: all 0.3s ease;
  }
  .project-card:hover {
    transform: translateY(-5px);
    border-color: #25BCC0;
    box-shadow: 0 0 15px rgba(37, 188, 192, 0.4);
    text-decoration: none;
  }

  /* Header row */
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    font-family: 'Fira Code', monospace;
    font-size: 0.75rem;
  }
  .card-prj {
    color: #AB2A3E;
    font-weight: 700;
    letter-spacing: 0.1em;
  }
  .card-status-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .card-status-dot {
    width: 8px;
    height: 8px;
    display: inline-block;
    background: #25BCC0;
  }
  .card-status-dot--pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  .card-status-label {
    color: #25BCC0;
    letter-spacing: 0.05em;
  }
  .card-status-label--pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Title */
  .card-title {
    font-family: 'Teko', 'Space Grotesk', sans-serif;
    font-size: 2.25rem;
    font-weight: 700;
    color: #fff;
    text-transform: uppercase;
    line-height: 1;
    margin: 0 0 0.75rem 0;
    transition: color 0.3s ease;
  }

  /* Description */
  .card-description {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.875rem;
    font-weight: 300;
    color: #9CA3AF;
    line-height: 1.625;
    margin: 0 0 2rem 0;
  }

  /* Footer */
  .card-footer {
    margin-top: auto;
  }
  .card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .card-tag {
    font-family: 'Fira Code', monospace;
    font-size: 0.7rem;
    color: #888;
    background: rgba(0, 0, 0, 0.3);
    padding: 0.125rem 0.375rem;
    border: 1px solid #333;
  }

  /* Hover: fill all segments */
  .project-card:hover :global(.xiuhcoatl-bar) {
    opacity: 1;
  }
  .project-card:hover :global(.segment) {
    background: #25BCC0;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: .5; }
  }
</style>
