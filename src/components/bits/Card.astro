---
import { getLocalizedPath, type Locale } from "@lib/i18n";
import { type CollectionEntry } from "astro:content";
import CardHeader from "./card/CardHeader.astro";
import CardFooter from "./card/CardFooter.astro";

interface Props {
  project: CollectionEntry<'bits'>;
  lang: Locale;
  index: number;
}

const { project, lang, index } = Astro.props;
const { data, slug } = project;
const href = getLocalizedPath(`/bits/${slug.split('/').pop()}`, lang);
const prjCode = `PRJ_${String(index).padStart(2, '0')}`;
---

<a href={href} class="project-card group">
  <CardHeader prjCode={prjCode} status={data.status} />
  
  <h3 class="card-title">{data.title}</h3>
  
  <p class="card-description">{data.description}</p>
  
  <CardFooter progress={data.progress} stack={data.stack} />
</a>

<style>
  .project-card {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 320px;
    padding: 1.5rem;
    background: theme('colors.plate-dark');
    border: 1px solid theme('colors.border-mid');
    text-decoration: none;
    position: relative;
    transition: all 0.3s ease;
  }
  .project-card:hover {
    transform: translateY(-5px);
    border-color: theme('colors.primary');
    box-shadow: 0 0 15px theme('colors.primary-medium');
    text-decoration: none;
  }

  /* Title */
  .card-title {
    font-family: 'Teko', 'Space Grotesk', sans-serif;
    font-size: 2.25rem;
    font-weight: 700;
    color: theme('colors.content-bright');
    text-transform: uppercase;
    line-height: 1;
    margin: 0 0 0.75rem 0;
    transition: color 0.3s ease;
  }

  /* Description */
  .card-description {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.875rem;
    font-weight: 300;
    color: theme('colors.content-dim');
    line-height: 1.625;
    margin: 0 0 2rem 0;
  }

  /* Hover: fill all segments */
  .project-card:hover :global(.xiuhcoatl-bar) {
    opacity: 1;
  }
  .project-card:hover :global(.segment) {
    background: theme('colors.primary');
  }
</style>
