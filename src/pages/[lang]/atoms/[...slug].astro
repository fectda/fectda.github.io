---
import { getCollection } from "astro:content";
import ProjectLayout from "@layouts/ProjectLayout.astro";
import type { Locale } from "@lib/i18n";
import { ATOMS_CONTENT } from "src/data/atoms-content";
import { getImagesForContent } from "@lib/image-discovery";

export async function getStaticPaths() {
  const posts = (await getCollection("atoms"))
    .filter(post => !post.data.draft || import.meta.env.DEV);
  
  const paths = [];
  for (const post of posts) {
    const [lang, ...slugParts] = post.slug.split('/');
    const cleanSlug = slugParts.join('/');

    // Auto-discover images from public/atoms/{slug}/
    const discoveredImages = getImagesForContent("atoms", post.id);
    if (discoveredImages.length > 0) {
      post.data.images = discoveredImages;
    }

    paths.push({
      params: { lang, slug: cleanSlug },
      props: post,
    });
  }
  return paths;
}



const post = Astro.props;
const { Content } = await post.render();
const { lang } = Astro.params as { lang: Locale };
const atomsContent = ATOMS_CONTENT[lang];
---

<ProjectLayout post={post} lang={lang} labels={atomsContent}>
  <Content />
</ProjectLayout>
