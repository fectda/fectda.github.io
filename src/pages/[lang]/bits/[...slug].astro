---
import { type CollectionEntry, getCollection } from "astro:content";
import ProjectLayout from "@layouts/ProjectLayout.astro";
import type { Locale } from "@lib/i18n";
import { BITS_CONTENT } from "src/data/bits-content";

export async function getStaticPaths() {
  const posts = (await getCollection("bits"))
    .filter(post => !post.data.draft);
  
  const paths = [];
  for (const post of posts) {
    const [lang, ...slugParts] = post.slug.split('/');
    const cleanSlug = slugParts.join('/');
    paths.push({
      params: { lang, slug: cleanSlug },
      props: post,
    });
  }
  return paths;
}

type Props = CollectionEntry<"bits">;

const post = Astro.props;
const { Content } = await post.render();
const { lang } = Astro.params as { lang: Locale };
const bitsContent = BITS_CONTENT[lang];
---

<ProjectLayout post={post} lang={lang} labels={bitsContent}>
  <Content />
</ProjectLayout>
