---
import PageLayout from "@layouts/PageLayout.astro";
import InfoBar from "@components/InfoBar.astro";
import TechChip from "@components/project/TechChip.astro";
import FigImage from "@components/project/FigImage.astro";
import SectionHeader from "@components/project/SectionHeader.astro";
import RepositoryCard from "@components/project/RepositoryCard.astro";
import type { CollectionEntry } from "astro:content";
import type { Locale } from "@lib/i18n";

interface Props {
  post: CollectionEntry<"bits"> | CollectionEntry<"atoms">;
  lang: Locale;
  labels: {
    toolkit: string;
    repository: string;
  };
}

const { post, lang, labels } = Astro.props;
---

<PageLayout title={post.data.title} description={post.data.description} lang={lang} className="flex-grow">

    <SectionHeader title={post.data.title} subtitle={post.data.description} />

    <InfoBar 
      items={[
        { label: 'DATE', value: post.data.date.getFullYear().toString() },
        { label: 'TYPE', value: post.data.type?.toUpperCase() || 'PROJECT' },
        { label: 'STATUS', value: post.data.status.toUpperCase() }
      ]}
    />

    <article class="w-full space-y-12">
      
      <FigImage images={post.data.images} alt={post.data.title} />

      <div class="prose prose-invert prose-lg max-w-none 
        prose-headings:font-bold prose-headings:uppercase prose-headings:text-white prose-headings:font-mono
        prose-p:text-gray-300 prose-p:font-body prose-p:text-base prose-p:leading-relaxed">
        
        <slot />
        <hr />
      </div>
      <div class="w-full">
         <h2 class="section-title">{labels.toolkit}</h2>
         <div class="flex flex-wrap gap-3 mt-6">
            {post.data.stack.map((tech: string) => (
                <TechChip text={tech} />
            ))}
         </div>
      </div>

      {post.data.repository_url && (
        <RepositoryCard title={labels.repository} url={post.data.repository_url} />
      )}
    </article>
</PageLayout>

<style is:global>
  /* Global typography overrides for the prose content */
  
  /* 1. Ensure list items match body text size and font */
  .prose ul > li, 
  .prose ol > li {
    font-family: 'Montserrat', sans-serif !important;
    font-size: 1rem !important;
    color: theme('colors.gray.300') !important;
    line-height: 1.75 !important;
    margin-top: 0.5em !important;
    margin-bottom: 0.5em !important;
  }
  
  /* Ensure paragraphs inside lists also inherit correct styles */
  .prose li p {
    font-family: 'Montserrat', sans-serif !important;
    font-size: 1rem !important;
    color: theme('colors.gray.300') !important;
    margin: 0 !important;
  }
</style>

<style>
  article {
    counter-reset: section;
  }
  
  /* Target both markdown H2 and manual .section-title class globally */
  :global(.prose h2), :global(.section-title) {
    @apply text-xl text-[#25BCC0] font-mono tracking-widest mb-6 mt-12 uppercase flex items-center gap-2;
  }
  
  :global(.prose h2::before), :global(.section-title::before) {
    counter-increment: section;
    content: "0" counter(section) " // ";
    @apply text-[#25BCC0] opacity-100;
  }

  /* Target markdown H3 for subsections */
  :global(.prose h3) {
      @apply text-lg text-white font-bold tracking-wide uppercase mt-8 mb-4;
  }


</style>
